<!-- HVAC Scheduling Widget - Isolated Component -->
<div id="hvac-scheduler-widget" style="font-family: Arial, sans-serif; max-width: 800px; margin: 20px auto; background: white; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden; position: relative;">
    
    <!-- Header -->
    <div style="background: linear-gradient(135deg, #2193b0, #6dd5ed); color: white; padding: 40px; text-align: center;">
        <h2 style="font-size: 2.5em; margin: 0 0 10px 0; font-weight: bold;">Schedule HVAC Service</h2>
        <p style="font-size: 1.2em; opacity: 0.9; margin: 0 0 15px 0;">Book your heating & cooling appointment today</p>
        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin-top: 15px; font-size: 14px;">
            ðŸ”’ Secure Form â€¢ Spam Protected â€¢ Your Privacy Matters
        </div>
    </div>

    <!-- Content Container -->
    <div style="padding: 40px;">
        
        <!-- Progress Bar -->
        <div style="display: flex; justify-content: center; margin-bottom: 30px;">
            <div id="progress-1" style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); color: white; display: flex; align-items: center; justify-content: center; margin: 0 10px; font-weight: bold;">1</div>
            <div id="progress-2" style="width: 40px; height: 40px; border-radius: 50%; background: #e9ecef; display: flex; align-items: center; justify-content: center; margin: 0 10px; font-weight: bold;">2</div>
            <div id="progress-3" style="width: 40px; height: 40px; border-radius: 50%; background: #e9ecef; display: flex; align-items: center; justify-content: center; margin: 0 10px; font-weight: bold;">3</div>
            <div id="progress-4" style="width: 40px; height: 40px; border-radius: 50%; background: #e9ecef; display: flex; align-items: center; justify-content: center; margin: 0 10px; font-weight: bold;">4</div>
        </div>

        <!-- Step 1: Select Date -->
        <div id="step-1" style="display: block;">
            <h3 style="font-size: 1.8em; color: #333; margin-bottom: 20px; text-align: center;">Select a Date</h3>
            <div id="calendar" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; margin-bottom: 30px;">
                <!-- Calendar will be generated by JavaScript -->
            </div>
            <div style="text-align: center; margin-top: 30px;">
                <button id="next-btn-1" onclick="nextStep()" disabled style="background: #ccc; color: white; border: none; padding: 15px 40px; border-radius: 10px; font-size: 16px; font-weight: 500; cursor: not-allowed; text-transform: uppercase; letter-spacing: 1px;">Next Step</button>
            </div>
        </div>

        <!-- Step 2: Select Time -->
        <div id="step-2" style="display: none;">
            <h3 style="font-size: 1.8em; color: #333; margin-bottom: 20px; text-align: center;">Select a Time</h3>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h4 style="color: #333; margin-bottom: 10px;">Selected Date: <span id="selected-date"></span></h4>
            </div>
            <div id="time-slots" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; margin-bottom: 30px;">
                <!-- Time slots will be generated by JavaScript -->
            </div>
            <div style="text-align: center; margin-top: 30px;">
                <button onclick="prevStep()" style="background: #6c757d; color: white; border: none; padding: 15px 40px; border-radius: 10px; font-size: 16px; font-weight: 500; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; margin-right: 15px;">Back</button>
                <button id="next-btn-2" onclick="nextStep()" disabled style="background: #ccc; color: white; border: none; padding: 15px 40px; border-radius: 10px; font-size: 16px; font-weight: 500; cursor: not-allowed; text-transform: uppercase; letter-spacing: 1px;">Next Step</button>
            </div>
        </div>

        <!-- Step 3: Contact Information -->
        <div id="step-3" style="display: none;">
            <h3 style="font-size: 1.8em; color: #333; margin-bottom: 20px; text-align: center;">Your Information</h3>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h4 style="color: #333; margin-bottom: 10px;">Appointment Details:</h4>
                <p style="margin: 5px 0;"><strong>Date:</strong> <span id="confirm-date"></span></p>
                <p style="margin: 5px 0;"><strong>Time:</strong> <span id="confirm-time"></span></p>
            </div>
            <form id="contact-form">
                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">Service Needed *</label>
                    <select id="service-type" name="service-type" required style="width: 100%; padding: 15px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px;">
                        <option value="">Select Service Type</option>
                        <option value="AC Repair">AC Repair</option>
                        <option value="AC Installation">AC Installation</option>
                        <option value="AC Maintenance">AC Maintenance</option>
                        <option value="Heating Repair">Heating Repair</option>
                        <option value="Heating Installation">Heating Installation</option>
                        <option value="Heating Maintenance">Heating Maintenance</option>
                        <option value="Duct Work">Duct Work</option>
                        <option value="Emergency Service">Emergency Service</option>
                        <option value="Other">Other (specify in notes)</option>
                    </select>
                </div>
                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">Full Name *</label>
                    <input type="text" id="name" name="name" required style="width: 100%; padding: 15px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px; box-sizing: border-box;">
                </div>
                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">Email Address *</label>
                    <input type="email" id="email" name="email" required style="width: 100%; padding: 15px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px; box-sizing: border-box;">
                </div>
                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">Phone Number *</label>
                    <input type="tel" id="phone" name="phone" required style="width: 100%; padding: 15px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px; box-sizing: border-box;">
                </div>
                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">Service Address *</label>
                    <input type="text" id="address" name="address" placeholder="Where do you need service?" required style="width: 100%; padding: 15px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px; box-sizing: border-box;">
                </div>
                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">Problem Description / Additional Notes</label>
                    <textarea id="message" name="message" rows="4" placeholder="Please describe the HVAC issue or any specific requests..." style="width: 100%; padding: 15px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px; box-sizing: border-box; resize: vertical;"></textarea>
                </div>
                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">Security Check: What is <span id="math-question"></span>? *</label>
                    <input type="number" id="captcha" name="captcha" required placeholder="Enter the answer" style="width: 100%; padding: 15px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px; box-sizing: border-box;">
                    <small style="color: #666; font-size: 14px;">This helps us prevent spam</small>
                </div>
                <div style="margin-bottom: 25px;">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" id="terms" name="terms" required style="margin-right: 10px;">
                        I confirm this is a genuine service request and agree to be contacted about my HVAC needs *
                    </label>
                </div>
            </form>
            <div style="text-align: center; margin-top: 30px;">
                <button onclick="prevStep()" style="background: #6c757d; color: white; border: none; padding: 15px 40px; border-radius: 10px; font-size: 16px; font-weight: 500; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; margin-right: 15px;">Back</button>
                <button id="submit-btn" onclick="submitAppointment()" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 15px 40px; border-radius: 10px; font-size: 16px; font-weight: 500; cursor: pointer; text-transform: uppercase; letter-spacing: 1px;">Book Appointment</button>
            </div>
        </div>

        <!-- Step 4: Confirmation -->
        <div id="step-4" style="display: none;">
            <div style="text-align: center; padding: 40px;">
                <div style="font-size: 4em; color: #28a745; margin-bottom: 20px;">âœ“</div>
                <h3 style="margin-bottom: 20px;">Service Request Submitted!</h3>
                <p style="margin-bottom: 30px;">Thank you for choosing us for your HVAC needs. We've received your service request and will contact you shortly to confirm the appointment and provide an accurate estimate.</p>
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px; text-align: left;">
                    <h4 style="color: #333; margin-bottom: 10px;">Your Service Request:</h4>
                    <p style="margin: 5px 0;"><strong>Service:</strong> <span id="final-service"></span></p>
                    <p style="margin: 5px 0;"><strong>Date:</strong> <span id="final-date"></span></p>
                    <p style="margin: 5px 0;"><strong>Time:</strong> <span id="final-time"></span></p>
                    <p style="margin: 5px 0;"><strong>Address:</strong> <span id="final-address"></span></p>
                    <p style="margin: 5px 0;"><strong>Name:</strong> <span id="final-name"></span></p>
                    <p style="margin: 5px 0;"><strong>Email:</strong> <span id="final-email"></span></p>
                    <p style="margin: 5px 0;"><strong>Phone:</strong> <span id="final-phone"></span></p>
                </div>
                <button onclick="resetForm()" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 15px 40px; border-radius: 10px; font-size: 16px; font-weight: 500; cursor: pointer; text-transform: uppercase; letter-spacing: 1px;">Schedule Another Service</button>
            </div>
        </div>
    </div>
</div>

<!-- EmailJS SDK -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
<script>
    // Initialize EmailJS
    emailjs.init("IJHcoSxlSQ9OPOJGS");
    
    let currentStep = 1;
    let selectedDate = null;
    let selectedTime = null;
    let appointmentData = {};
    let lastSubmissionTime = 0;
    let submissionAttempts = 0;
    let mathAnswer = 0;

    // Spam prevention variables
    const minTimeBetweenSubmissions = 30000; // 30 seconds
    const maxSubmissionsPerHour = 3;
    let hourlySubmissions = [];

    // Available time slots for HVAC services (weekdays only)
    const timeSlots = [
        "8:00 AM", "9:00 AM", "10:00 AM", "11:00 AM", "12:00 PM",
        "1:00 PM", "2:00 PM", "3:00 PM", "4:00 PM"
    ];

    // Unavailable dates (add specific dates to block)
    const unavailableDates = [];

    function generateCalendar() {
        const calendar = document.getElementById('calendar');
        calendar.innerHTML = '';
        const today = new Date();
        
        // Calendar headers
        const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        days.forEach(day => {
            const header = document.createElement('div');
            header.style.cssText = 'text-align: center; font-weight: bold; padding: 15px; background: #f8f9fa; border-radius: 10px; color: #666;';
            header.textContent = day;
            calendar.appendChild(header);
        });

        // Calculate first day of current month and how many days to show
        const startDate = new Date(today);
        const endDate = new Date(today);
        endDate.setDate(today.getDate() + 30);

        // Find the first Sunday on or before our start date to properly align the calendar
        const firstCalendarDate = new Date(startDate);
        firstCalendarDate.setDate(startDate.getDate() - startDate.getDay());

        // Generate calendar cells (6 weeks = 42 days to ensure full coverage)
        for (let i = 0; i < 42; i++) {
            const currentDate = new Date(firstCalendarDate);
            currentDate.setDate(firstCalendarDate.getDate() + i);
            
            const dayElement = document.createElement('div');
            const isInRange = currentDate >= startDate && currentDate <= endDate;
            const isPastDate = currentDate < today;
            const dayOfWeek = currentDate.getDay(); // 0=Sunday, 6=Saturday
            const isWeekend = (dayOfWeek === 0 || dayOfWeek === 6);
            
            // Only show dates in our range (today + 30 days)
            if (!isInRange) {
                // Empty cell for dates outside our range
                dayElement.style.cssText = 'text-align: center; padding: 15px;';
                dayElement.innerHTML = '';
            } else {
                const dateString = currentDate.toISOString().split('T')[0];
                const isUnavailable = unavailableDates.includes(dateString);
                const shouldDisable = isWeekend || isUnavailable || isPastDate;
                
                if (shouldDisable) {
                    // DISABLE: Weekends, unavailable dates, or past dates
                    dayElement.style.cssText = 'text-align: center; padding: 15px; border: 2px solid #e9ecef; border-radius: 10px; background: #f8f9fa; color: #ccc; cursor: not-allowed;';
                } else {
                    // ENABLE: Monday through Friday (weekdays) in future
                    dayElement.style.cssText = 'text-align: center; padding: 15px; border: 2px solid #e9ecef; border-radius: 10px; cursor: pointer; background: white; transition: all 0.3s ease;';
                    dayElement.onmouseover = function() { 
                        if (!this.classList.contains('selected')) {
                            this.style.borderColor = '#667eea'; 
                            this.style.transform = 'translateY(-2px)'; 
                            this.style.boxShadow = '0 5px 15px rgba(0,0,0,0.1)'; 
                        }
                    };
                    dayElement.onmouseout = function() { 
                        if (!this.classList.contains('selected')) { 
                            this.style.borderColor = '#e9ecef'; 
                            this.style.transform = 'none'; 
                            this.style.boxShadow = 'none'; 
                        } 
                    };
                    // Pass the correct currentDate to selectDate
                    dayElement.onclick = () => selectDate(new Date(currentDate), dayElement);
                }
                
                // Date display
                dayElement.innerHTML = `
                    <div style="font-size: 0.9em; color: ${shouldDisable ? '#ccc' : '#666'};">${currentDate.toLocaleDateString('en', {month: 'short'})}</div>
                    <div style="font-size: 1.2em; font-weight: bold; color: ${shouldDisable ? '#ccc' : 'inherit'};">${currentDate.getDate()}</div>
                `;
            }
            
            calendar.appendChild(dayElement);
        }
    }

    function selectDate(date, element) {
        // Remove previous selection
        document.querySelectorAll('#calendar > div').forEach(el => {
            if (el.style.background === 'linear-gradient(135deg, rgb(102, 126, 234), rgb(118, 75, 162))') {
                el.style.cssText = 'text-align: center; padding: 15px; border: 2px solid #e9ecef; border-radius: 10px; cursor: pointer; background: white; transition: all 0.3s ease;';
            }
        });
        
        // Select new date
        element.style.cssText = 'text-align: center; padding: 15px; border: 2px solid #667eea; border-radius: 10px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; cursor: pointer;';
        element.classList.add('selected');
        selectedDate = date;
        
        // Enable next button
        const nextBtn = document.getElementById('next-btn-1');
        nextBtn.disabled = false;
        nextBtn.style.cssText = 'background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 15px 40px; border-radius: 10px; font-size: 16px; font-weight: 500; cursor: pointer; text-transform: uppercase; letter-spacing: 1px;';
        
        // Update selected date display
        document.getElementById('selected-date').textContent = date.toLocaleDateString('en', {
            weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
        });
    }

    function generateTimeSlots() {
        const timeSlotsContainer = document.getElementById('time-slots');
        timeSlotsContainer.innerHTML = '';
        
        timeSlots.forEach(time => {
            const slot = document.createElement('div');
            slot.style.cssText = 'padding: 15px; text-align: center; border: 2px solid #e9ecef; border-radius: 10px; cursor: pointer; background: white; font-weight: 500; transition: all 0.3s ease;';
            slot.textContent = time;
            slot.onmouseover = function() { if(!this.classList.contains('selected')) { this.style.borderColor = '#667eea'; this.style.transform = 'translateY(-2px)'; this.style.boxShadow = '0 5px 15px rgba(0,0,0,0.1)'; } };
            slot.onmouseout = function() { if(!this.classList.contains('selected')) { this.style.borderColor = '#e9ecef'; this.style.transform = 'none'; this.style.boxShadow = 'none'; } };
            slot.onclick = () => selectTime(time, slot);
            timeSlotsContainer.appendChild(slot);
        });
    }

    function selectTime(time, element) {
        // Remove previous selection
        document.querySelectorAll('#time-slots > div').forEach(el => {
            el.style.cssText = 'padding: 15px; text-align: center; border: 2px solid #e9ecef; border-radius: 10px; cursor: pointer; background: white; font-weight: 500; transition: all 0.3s ease;';
            el.classList.remove('selected');
        });
        
        // Select new time
        element.style.cssText = 'padding: 15px; text-align: center; border: 2px solid #667eea; border-radius: 10px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; cursor: pointer; font-weight: 500;';
        element.classList.add('selected');
        selectedTime = time;
        
        // Enable next button
        const nextBtn = document.getElementById('next-btn-2');
        nextBtn.disabled = false;
        nextBtn.style.cssText = 'background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 15px 40px; border-radius: 10px; font-size: 16px; font-weight: 500; cursor: pointer; text-transform: uppercase; letter-spacing: 1px;';
        
        // Update confirmation displays
        document.getElementById('confirm-date').textContent = selectedDate.toLocaleDateString('en', {
            weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
        });
        document.getElementById('confirm-time').textContent = time;
    }

    function nextStep() {
        if (currentStep === 1 && !selectedDate) return;
        if (currentStep === 2 && !selectedTime) return;
        
        // Hide current step
        document.getElementById(`step-${currentStep}`).style.display = 'none';
        document.getElementById(`progress-${currentStep}`).style.cssText = 'width: 40px; height: 40px; border-radius: 50%; background: #28a745; color: white; display: flex; align-items: center; justify-content: center; margin: 0 10px; font-weight: bold;';
        
        currentStep++;
        
        // Show next step
        document.getElementById(`step-${currentStep}`).style.display = 'block';
        document.getElementById(`progress-${currentStep}`).style.cssText = 'width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); color: white; display: flex; align-items: center; justify-content: center; margin: 0 10px; font-weight: bold;';
        
        // Generate time slots when moving to step 2
        if (currentStep === 2) {
            generateTimeSlots();
        }
    }

    function prevStep() {
        if (currentStep === 1) return;
        
        // Hide current step
        document.getElementById(`step-${currentStep}`).style.display = 'none';
        document.getElementById(`progress-${currentStep}`).style.cssText = 'width: 40px; height: 40px; border-radius: 50%; background: #e9ecef; display: flex; align-items: center; justify-content: center; margin: 0 10px; font-weight: bold;';
        
        currentStep--;
        
        // Show previous step
        document.getElementById(`step-${currentStep}`).style.display = 'block';
        document.getElementById(`progress-${currentStep}`).style.cssText = 'width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); color: white; display: flex; align-items: center; justify-content: center; margin: 0 10px; font-weight: bold;';
    }

    // Generate simple math CAPTCHA
    function generateMathCaptcha() {
        const num1 = Math.floor(Math.random() * 10) + 1;
        const num2 = Math.floor(Math.random() * 10) + 1;
        const operations = ['+', '-'];
        const operation = operations[Math.floor(Math.random() * operations.length)];
        
        let question, answer;
        if (operation === '+') {
            question = `${num1} + ${num2}`;
            answer = num1 + num2;
        } else {
            const larger = Math.max(num1, num2);
            const smaller = Math.min(num1, num2);
            question = `${larger} - ${smaller}`;
            answer = larger - smaller;
        }
        
        document.getElementById('math-question').textContent = question;
        mathAnswer = answer;
    }

    function validateCaptcha() {
        const userAnswer = parseInt(document.getElementById('captcha').value);
        if (userAnswer !== mathAnswer) {
            alert('Security check failed. Please solve the math problem correctly.');
            generateMathCaptcha();
            document.getElementById('captcha').value = '';
            return false;
        }
        return true;
    }

    function submitAppointment() {
        const form = document.getElementById('contact-form');
        const formData = new FormData(form);
        
        if (!form.checkValidity()) {
            form.reportValidity();
            return;
        }

        if (!validateCaptcha()) return;
        
        if (!document.getElementById('terms').checked) {
            alert('Please confirm this is a genuine service request.');
            return;
        }
        
        appointmentData = {
            date: selectedDate.toLocaleDateString('en', {weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'}),
            time: selectedTime,
            serviceType: formData.get('service-type'),
            name: formData.get('name'),
            email: formData.get('email'),
            phone: formData.get('phone'),
            address: formData.get('address'),
            message: formData.get('message') || 'No additional notes',
            timestamp: new Date().toISOString()
        };
        
        document.getElementById('submit-btn').disabled = true;
        document.getElementById('submit-btn').textContent = 'Sending...';
        
        sendAppointmentEmail(appointmentData);
    }

    function sendAppointmentEmail(data) {
        const emailData = {
            to_email: 'office@mechanicaltemp.com',
            cc_email: 'mthvacr@gmail.com',
            bcc_email: '3132824758@vtext.com,3136004012@vtext.com', // SMS via email gateway
            from_name: data.name,
            from_email: data.email,
            phone: data.phone,
            service_type: data.serviceType,
            service_address: data.address,
            appointment_date: data.date,
            appointment_time: data.time,
            message: data.message,
            subject: `ðŸ”§ HVAC Service: ${data.serviceType} - ${data.date} ${data.time}`
        };
        
        emailjs.send('service_ziwf1pg', 'template_q5fbhd8', emailData)
            .then(function(response) {
                console.log('Email and SMS sent successfully:', response);
                showConfirmation();
            }, function(error) {
                console.log('Email failed:', error);
                showConfirmation(); // Still show confirmation
            });
    }

    function sendSMSNotification(data) {
        // SMS now handled via email-to-SMS gateway above
        // TextBelt integration kept for future use if needed
        console.log('SMS notifications sent via email-to-SMS gateway');
    }

    function showConfirmation() {
        document.getElementById('final-service').textContent = appointmentData.serviceType;
        document.getElementById('final-date').textContent = appointmentData.date;
        document.getElementById('final-time').textContent = appointmentData.time;
        document.getElementById('final-address').textContent = appointmentData.address;
        document.getElementById('final-name').textContent = appointmentData.name;
        document.getElementById('final-email').textContent = appointmentData.email;
        document.getElementById('final-phone').textContent = appointmentData.phone;
        
        document.getElementById(`step-${currentStep}`).style.display = 'none';
        document.getElementById(`progress-${currentStep}`).style.cssText = 'width: 40px; height: 40px; border-radius: 50%; background: #28a745; color: white; display: flex; align-items: center; justify-content: center; margin: 0 10px; font-weight: bold;';
        
        currentStep = 4;
        document.getElementById(`step-${currentStep}`).style.display = 'block';
        document.getElementById(`progress-${currentStep}`).style.cssText = 'width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); color: white; display: flex; align-items: center; justify-content: center; margin: 0 10px; font-weight: bold;';
    }

    function resetForm() {
        currentStep = 1;
        selectedDate = null;
        selectedTime = null;
        appointmentData = {};
        
        document.getElementById('contact-form').reset();
        
        // Reset all steps
        for (let i = 1; i <= 4; i++) {
            document.getElementById(`step-${i}`).style.display = i === 1 ? 'block' : 'none';
            document.getElementById(`progress-${i}`).style.cssText = i === 1 ? 
                'width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); color: white; display: flex; align-items: center; justify-content: center; margin: 0 10px; font-weight: bold;' :
                'width: 40px; height: 40px; border-radius: 50%; background: #e9ecef; display: flex; align-items: center; justify-content: center; margin: 0 10px; font-weight: bold;';
        }
        
        const nextBtn1 = document.getElementById('next-btn-1');
        nextBtn1.disabled = true;
        nextBtn1.style.cssText = 'background: #ccc; color: white; border: none; padding: 15px 40px; border-radius: 10px; font-size: 16px; font-weight: 500; cursor: not-allowed; text-transform: uppercase; letter-spacing: 1px;';
        
        const nextBtn2 = document.getElementById('next-btn-2');
        nextBtn2.disabled = true;
        nextBtn2.style.cssText = 'background: #ccc; color: white; border: none; padding: 15px 40px; border-radius: 10px; font-size: 16px; font-weight: 500; cursor: not-allowed; text-transform: uppercase; letter-spacing: 1px;';
        
        document.getElementById('submit-btn').disabled = false;
        document.getElementById('submit-btn').textContent = 'Book Appointment';
        
        generateCalendar();
        generateMathCaptcha();
    }

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', function() {
        generateCalendar();
        generateMathCaptcha();
    });
</script>
